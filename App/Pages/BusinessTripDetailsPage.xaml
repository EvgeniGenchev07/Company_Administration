<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:pageModels="clr-namespace:App.PageModels"
             xmlns:models="clr-namespace:BusinessLayer;assembly=BusinessLayer"
             xmlns:converters="clr-namespace:App.Converters"
             x:Class="App.Pages.BusinessTripDetailsPage"
             x:DataType="pageModels:BusinessTripDetailsPageModel">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:StatusToTextConverter x:Key="StatusToTextConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,*">
        <!-- Header with frame content -->
        <Frame Grid.Row="0" 
           BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource Primary}}"
           Padding="20"
           Margin="0"
           CornerRadius="0">
            <Grid RowDefinitions="Auto,Auto" ColumnDefinitions="Auto,*,Auto">
                <!-- Cancel Button (Left) -->
                <Button Grid.Row="0" Grid.Column="0"
                    Text="â† ÐÐ°Ð·Ð°Ð´" 
                    Command="{Binding CancelCommand}"
                    BackgroundColor="Transparent"
                    TextColor="White"
                    FontSize="16"
                    HorizontalOptions="Start"
                    VerticalOptions="Center"/>

                <!-- Project Name (Middle) -->
                <Label Grid.Row="0" Grid.Column="1"
                   Text="{Binding BusinessTrip.ProjectName}" 
                   FontSize="20" 
                   FontAttributes="Bold"
                   TextColor="White"
                   HorizontalOptions="Center"
                   VerticalOptions="Center"/>

                <!-- Status (Right) -->
                <Label Grid.Row="0" Grid.Column="2"
                   Text="{Binding BusinessTrip.Status, Converter={StaticResource StatusToTextConverter}}"
                   FontSize="14"
                   TextColor="White"
                   FontAttributes="Bold"
                   HorizontalOptions="End"
                   VerticalOptions="Center"/>

            </Grid>
        </Frame>

        <!-- Content -->
        <ScrollView Grid.Row="1" VerticalScrollBarVisibility="Never">
            <VerticalStackLayout Padding="20" Spacing="15">

                <!-- Quick Info Cards - Now with full width utilization -->
                <Grid ColumnDefinitions="*,10,*" ColumnSpacing="0" Margin="0,0,0,10">
                    <!-- Start Date Card -->
                    <Frame Grid.Column="0"
                        BackgroundColor="{AppThemeBinding Light=#F8F9FA, Dark=#2D2D2D}"
                        CornerRadius="10" 
                        Padding="15"
                        HasShadow="True"
                        HorizontalOptions="FillAndExpand">
                        <VerticalStackLayout HorizontalOptions="Center" Spacing="5">
                            <Label Text="ðŸ“…" FontSize="24" HorizontalOptions="Center"/>
                            <Label Text="{Binding BusinessTrip.StartDate, StringFormat='{0:dd/MM/yyyy}'}" 
                   FontSize="16" FontAttributes="Bold" HorizontalOptions="Center"/>
                            <Label Text="ÐÐ°Ñ‡Ð°Ð»Ð½Ð° Ð´Ð°Ñ‚Ð°" FontSize="12" HorizontalOptions="Center"/>
                        </VerticalStackLayout>
                    </Frame>

                    <!-- Destination Card -->
                    <Frame Grid.Column="2"
                        BackgroundColor="{AppThemeBinding Light=#F8F9FA, Dark=#2D2D2D}"
                        CornerRadius="10" 
                        Padding="15"
                        HasShadow="True"
                        HorizontalOptions="FillAndExpand">
                        <VerticalStackLayout HorizontalOptions="Center" Spacing="5">
                            <Label Text="ðŸ“" FontSize="24" HorizontalOptions="Center"/>
                            <Label Text="{Binding BusinessTrip.CarTripDestination}" 
                                FontSize="16" FontAttributes="Bold" HorizontalOptions="Center"/>
                            <Label Text="Ð”ÐµÑÑ‚Ð¸Ð½Ð°Ñ†Ð¸Ñ" FontSize="12" HorizontalOptions="Center"/>
                        </VerticalStackLayout>
                    </Frame>
                </Grid>

                <!-- Duration and Cost - Second Row -->
                <Grid ColumnDefinitions="*,10,*" ColumnSpacing="0">
                    <!-- Duration Card -->
                    <Frame Grid.Column="0"
                        BackgroundColor="{AppThemeBinding Light=#F8F9FA, Dark=#2D2D2D}"
                        CornerRadius="10" 
                        Padding="15"
                        HasShadow="True"
                        HorizontalOptions="FillAndExpand">
                        <VerticalStackLayout HorizontalOptions="Center" Spacing="5">
                            <Label Text="â±ï¸" FontSize="24" HorizontalOptions="Center"/>
                            <Label Text="{Binding BusinessTrip.TotalDays, StringFormat='{0} Ð´Ð½Ð¸'}" 
                                FontSize="16" FontAttributes="Bold" HorizontalOptions="Center"/>
                            <Label Text="ÐŸÑ€Ð¾Ð´ÑŠÐ»Ð¶Ð¸Ñ‚ÐµÐ»Ð½Ð¾ÑÑ‚" FontSize="12" HorizontalOptions="Center"/>
                        </VerticalStackLayout>
                    </Frame>

                    <!-- Cost Card -->
                    <Frame Grid.Column="2"
                        BackgroundColor="{AppThemeBinding Light=#F8F9FA, Dark=#2D2D2D}"
                        CornerRadius="10" 
                        Padding="15"
                        HasShadow="True"
                        HorizontalOptions="FillAndExpand">
                        <VerticalStackLayout HorizontalOptions="Center" Spacing="5">
                            <Label Text="ðŸ’°" FontSize="24" HorizontalOptions="Center"/>
                            <Label Text="{Binding TotalExpenses, StringFormat='{0:N0} Ð»Ð²'}" 
                                FontSize="16" FontAttributes="Bold" HorizontalOptions="Center"/>
                            <Label Text="ÐžÐ±Ñ‰Ð¾ Ñ€Ð°Ð·Ñ…Ð¾Ð´Ð¸" FontSize="12" HorizontalOptions="Center"/>
                        </VerticalStackLayout>
                    </Frame>
                </Grid>

                <!-- Edit Mode Toggle -->
                <Frame IsVisible="{Binding CanEdit}"
                       BackgroundColor="{AppThemeBinding Light=#FFF3CD, Dark=#856404}"
                       CornerRadius="10"
                       Padding="15"
                       BorderColor="{AppThemeBinding Light=#FFEAA7, Dark=#F39C12}">
                    <Grid ColumnDefinitions="*,Auto">
                        <VerticalStackLayout>
                            <Label Text="Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð°Ð½Ðµ" FontSize="16" FontAttributes="Bold"/>
                            <Label Text="ÐÐ°Ñ‚Ð¸ÑÐ½ÐµÑ‚Ðµ Ð±ÑƒÑ‚Ð¾Ð½Ð° Ð·Ð° Ð´Ð° Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð°Ñ‚Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¸Ñ€Ð¾Ð²ÐºÐ°Ñ‚Ð°" FontSize="12"/>
                        </VerticalStackLayout>
                        <Button Grid.Column="1" 
                                Text="{Binding EditButtonText}"
                                Command="{Binding ToggleEditCommand}"
                                BackgroundColor="{AppThemeBinding Light=#007AFF, Dark=#0A84FF}"
                                TextColor="White"
                                CornerRadius="20"
                                Padding="20,10"/>
                    </Grid>
                </Frame>

                <!-- Trip Details -->
                <Frame BorderColor="LightGray" CornerRadius="10" Padding="20" HasShadow="True">
                    <VerticalStackLayout Spacing="15">
                        <Label Text="ðŸ“‹ Ð”ÐµÑ‚Ð°Ð¹Ð»Ð¸ Ð·Ð° ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¸Ñ€Ð¾Ð²ÐºÐ°" FontSize="18" FontAttributes="Bold"/>

                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="15">
                            <Label Text="Ð—ÐÐŸÐžÐ’Ð•Ð” â„–:" FontSize="14" FontAttributes="Bold" VerticalOptions="Center"/>
                            <Entry Grid.Column="1" 
                                Text="{Binding BusinessTrip.IssueId}" 
                                IsEnabled="False"
                                TextColor="{Binding IsEditing}"
                                FontSize="14"/>
                        </Grid>

                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="15">
                            <Label Text="Ð”Ð°Ñ‚Ð° Ð½Ð° ÑÑŠÐ·Ð´Ð°Ð²Ð°Ð½Ðµ:" FontSize="14" FontAttributes="Bold" VerticalOptions="Center"/>
                            <Entry Grid.Column="1" 
                                Text="{Binding BusinessTrip.IssueDate}" 
                                IsEnabled="False"
                                   TextColor="{Binding IsEditing}"
                                   FontSize="14"/>
                        </Grid>

                        <!-- Project Name -->
                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="15">
                            <Label Text="ÐŸÑ€Ð¾ÐµÐºÑ‚:" FontSize="14" FontAttributes="Bold" VerticalOptions="Center"/>
                            <Entry Grid.Column="1" 
                                   Text="{Binding BusinessTrip.ProjectName}" 
                                   IsEnabled="{Binding IsEditing}"
                                   TextColor="{Binding IsEditing}"
                                   FontSize="14"/>
                        </Grid>

                        <!-- Task -->
                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="15">
                            <Label Text="Ð—Ð°Ð´Ð°Ñ‡Ð°:" FontSize="14" FontAttributes="Bold" VerticalOptions="Center"/>
                            <Entry Grid.Column="1" 
                                   Text="{Binding BusinessTrip.Task}" 
                                   IsEnabled="{Binding IsEditing}"
                                   TextColor="{Binding IsEditing}"
                                   FontSize="14"/>
                        </Grid>

                        <!-- Dates -->
                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="15">
                            <Label Text="ÐÐ°Ñ‡Ð°Ð»Ð½Ð° Ð´Ð°Ñ‚Ð°:" FontSize="14" FontAttributes="Bold" VerticalOptions="Center"/>
                            <DatePicker Grid.Column="1" 
                                       Date="{Binding BusinessTrip.StartDate}" 
                                       IsEnabled="{Binding IsEditing}"
                                       Format="dd/MM/yyyy"
                                       TextColor="{Binding IsEditing}"
                                       FontSize="14"/>
                        </Grid>

                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="15">
                            <Label Text="ÐšÑ€Ð°Ð¹Ð½Ð° Ð´Ð°Ñ‚Ð°:" FontSize="14" FontAttributes="Bold" VerticalOptions="Center"/>
                            <DatePicker Grid.Column="1" 
                                       Date="{Binding BusinessTrip.EndDate}" 
                                       IsEnabled="{Binding IsEditing}"
                                       Format="dd/MM/yyyy"
                                       TextColor="{Binding IsEditing}"
                                       FontSize="14"/>
                        </Grid>

                        <!-- Destination -->
                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="15">
                            <Label Text="Ð”ÐµÑÑ‚Ð¸Ð½Ð°Ñ†Ð¸Ñ:" FontSize="14" FontAttributes="Bold" VerticalOptions="Center"/>
                            <Entry Grid.Column="1" 
                                   Text="{Binding BusinessTrip.CarTripDestination}" 
                                   IsEnabled="{Binding IsEditing}"
                                   TextColor="{Binding IsEditing}"
                                   FontSize="14"/>
                        </Grid>

                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="15">
                            <Label Text="ÐžÑ‚Ð³Ð¾Ð²Ð¾Ñ€Ð½Ð¾ÑÑ‚ Ð·Ð° Ñ€Ð°Ð·Ñ…Ð¾Ð´Ð¸:" FontSize="14" FontAttributes="Bold" VerticalOptions="Center"/>
                            <Entry Grid.Column="1" 
                                Text="{Binding BusinessTrip.ExpensesResponsibility}" 
                                IsEnabled="{Binding IsEditing}"
                                TextColor="{Binding IsEditing}"
                                FontSize="14"/>
                        </Grid>
                    </VerticalStackLayout>
                </Frame>

                <!-- Financial Details -->
                <Frame BorderColor="LightGray" CornerRadius="10" Padding="20" HasShadow="True">
                    <VerticalStackLayout Spacing="15">
                        <Label Text="ðŸ’° Ð¤Ð¸Ð½Ð°Ð½ÑÐ¾Ð²Ð° Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ" FontSize="18" FontAttributes="Bold"/>

                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="15">
                            <Label Text="Ð”Ð½ÐµÐ²Ð½Ð¸ Ð¸Ð·Ð´Ñ€ÑŠÐ¶ÐºÐ¸:" FontSize="14" FontAttributes="Bold" VerticalOptions="Center"/>
                            <Entry Grid.Column="1" 
                                   Text="{Binding Wage}" 
                                   IsEnabled="{Binding IsEditing}"
                                   Keyboard="Numeric"
                                   TextColor="{Binding IsEditing}"
                                   FontSize="14"/>
                        </Grid>

                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="15">
                            <Label Text="ÐšÐ²Ð°Ñ€Ñ‚Ð¸Ñ€Ð½Ð¸ Ð¸Ð·Ð´Ñ€ÑŠÐ¶ÐºÐ¸:" FontSize="14" FontAttributes="Bold" VerticalOptions="Center"/>
                            <Entry Grid.Column="1" 
                                   Text="{Binding AccommodationMoney}" 
                                   IsEnabled="{Binding IsEditing}"
                                   Keyboard="Numeric"
                                   TextColor="{Binding IsEditing}"
                                   FontSize="14"/>
                        </Grid>

                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="15">
                            <Label Text="Ð”Ñ€ÑƒÐ³Ð¸ Ñ€Ð°Ð·Ñ…Ð¾Ð´Ð¸:" FontSize="14" FontAttributes="Bold" VerticalOptions="Center"/>
                            <Entry Grid.Column="1" 
                                Text="{Binding AdditionalExpences}" 
                                IsEnabled="{Binding IsEditing}"
                                Keyboard="Numeric"
                                TextColor="{Binding IsEditing}"
                                FontSize="14"/>
                        </Grid>

                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="15">
                            <Label Text="ÐžÐ±Ñ‰Ð¾:" FontSize="14" FontAttributes="Bold" VerticalOptions="Center"/>
                            <Label Grid.Column="1" 
                                   Text="{Binding TotalExpenses, StringFormat='{0:N2} Ð»Ð²'}" 
                                   FontSize="16" FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#007AFF, Dark=#0A84FF}"/>
                        </Grid>
                    </VerticalStackLayout>
                </Frame>

                <!-- Vehicle Information -->
                <Frame BorderColor="LightGray" CornerRadius="10" Padding="20" HasShadow="True">
                    <VerticalStackLayout Spacing="15">
                        <Label Text="ðŸš— Ð¢Ñ€Ð°Ð½ÑÐ¿Ð¾Ñ€Ñ‚Ð½Ð° Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ" FontSize="18" FontAttributes="Bold"/>

                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="15">
                            <Label Text="ÐœÐ°Ñ€ÐºÐ°:" FontSize="14" FontAttributes="Bold" VerticalOptions="Center"/>
                            <Entry Grid.Column="1" 
                                   Text="{Binding BusinessTrip.CarBrand}" 
                                   IsEnabled="{Binding IsEditing}"
                                   TextColor="{Binding IsEditing}"
                                   FontSize="14"/>
                        </Grid>

                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="15">
                            <Label Text="ÐœÐ¾Ð´ÐµÐ»:" FontSize="14" FontAttributes="Bold" VerticalOptions="Center"/>
                            <Entry Grid.Column="1" 
                                   Text="{Binding BusinessTrip.CarModel}" 
                                   IsEnabled="{Binding IsEditing}"
                                   TextColor="{Binding IsEditing}"
                                   FontSize="14"/>
                        </Grid>

                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="15">
                            <Label Text="Ð ÐµÐ³. Ð½Ð¾Ð¼ÐµÑ€:" FontSize="14" FontAttributes="Bold" VerticalOptions="Center"/>
                            <Entry Grid.Column="1" 
                                   Text="{Binding BusinessTrip.CarRegistrationNumber}" 
                                   IsEnabled="{Binding IsEditing}"
                                   TextColor="{Binding IsEditing    }"
                                   FontSize="14"/>
                        </Grid>

                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="15">
                            <Label Text="Ð¡Ð¾Ð±ÑÑ‚Ð²ÐµÐ½Ð¾ÑÑ‚:" FontSize="14" FontAttributes="Bold" VerticalOptions="Center"/>
                            <Entry Grid.Column="1" 
                                Text="{Binding BusinessTrip.CarOwnership}" 
                                IsEnabled="{Binding IsEditing}"
                                TextColor="{Binding IsEditing}"
                                FontSize="14"/>
                        </Grid>

                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="15">
                            <Label Text="Ð Ð°Ð·Ñ…Ð¾Ð´:" FontSize="14" FontAttributes="Bold" VerticalOptions="Center"/>
                            <Entry Grid.Column="1" 
                                Text="{Binding BusinessTrip.CarUsagePerHundredKm}" 
                                IsEnabled="{Binding IsEditing}"
                                TextColor="{Binding IsEditing}"
                                FontSize="14"/>
                        </Grid>

                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="15">
                            <Label Text="Ð¦ÐµÐ½Ð° Ð½Ð° Ð³Ð¾Ñ€Ð¸Ð²Ð¾ Ð·Ð° Ð»Ð¸Ñ‚ÑŠÑ€:" FontSize="14" FontAttributes="Bold" VerticalOptions="Center"/>
                            <Entry Grid.Column="1" 
                                Text="{Binding BusinessTrip.PricePerLiter}" 
                                IsEnabled="{Binding IsEditing}"
                                TextColor="{Binding IsEditing}"
                                FontSize="14"/>
                        </Grid>
                    </VerticalStackLayout>
                </Frame>

                <!-- Action Buttons -->
                <VerticalStackLayout Spacing="10" Margin="0,20,0,0">
                    

                    <Button Text="ÐžÑ‚ÐºÐ°Ð·" 
                            Command="{Binding CancelEditCommand}"
                            IsVisible="{Binding IsEditing}"
                            HorizontalOptions="Fill"
                            BackgroundColor="{AppThemeBinding Light=#DC3545, Dark=#E74C3C}"
                            TextColor="White"
                            FontSize="16"
                            HeightRequest="50"/>
                    <Button Text="Ð˜Ð·Ñ‚Ñ€Ð¸Ð²Ð°Ð½Ðµ" 
                        Command="{Binding DeleteCommand}"
                        IsVisible="{Binding IsEditing}"
                        HorizontalOptions="Fill"
                        BackgroundColor="{AppThemeBinding Light=#DC3545, Dark=#2ECC71}"
                        TextColor="White"
                        FontSize="16"
                        HeightRequest="50"/>        
                </VerticalStackLayout>

            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>